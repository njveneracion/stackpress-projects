"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class ArgString {
    constructor(nest) {
        this.nest = nest;
    }
    set(argv, skip = 0) {
        if (typeof argv === 'string') {
            let buffer = '';
            let quote = null;
            const args = [];
            for (let i = 0; i < argv.length; i++) {
                const char = argv[i];
                if (quote) {
                    if (char === quote) {
                        quote = null;
                        continue;
                    }
                    buffer += char;
                    continue;
                }
                if (char === '"' || char === "'") {
                    quote = char;
                    continue;
                }
                if (char === ' ') {
                    args.push(buffer);
                    buffer = '';
                    continue;
                }
                buffer += char;
            }
            if (buffer) {
                args.push(buffer);
            }
            return this.set(args, skip);
        }
        const args = argv.slice(skip);
        if (args.length < 1) {
            return this.nest;
        }
        const query = [];
        let index = 0, key = null;
        for (let i = 0; i < args.length; i++) {
            const arg = args[i];
            if (key) {
                query.push(`${key}=${arg}`);
                key = null;
                continue;
            }
            if (arg.startsWith('--')) {
                key = arg.substring(2);
                continue;
            }
            if (arg.startsWith('-')) {
                let flags = arg.substring(1);
                flags.split('').forEach(flag => query.push(`${flag}=true`));
                continue;
            }
            query.push(`${index++}=${arg}`);
        }
        if (query.length > 0) {
            this.nest.withQuery.set(query.join('&'));
        }
        return this.nest;
    }
}
exports.default = ArgString;
