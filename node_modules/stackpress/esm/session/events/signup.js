import { signup } from '../actions.js';
export default async function AuthSignup(req, res, ctx) {
    const roles = ctx.config.path('session.auth.roles', []);
    const engine = ctx.plugin('database');
    const client = ctx.plugin('client');
    const seed = ctx.config.path('database.seed', 'abc123');
    const input = { roles, ...req.data() };
    const response = await signup(input, seed, engine, client);
    if (response.code === 200) {
        if (input.email) {
            ctx.resolve('email-email-send', {
                email: input.email,
                ...response.results
            });
        }
        if (input.phone) {
            ctx.resolve('auth-phone-verify', {
                phone: input.phone,
                ...response.results
            });
        }
    }
    if (response.results?.auth.email) {
        delete response.results.auth.email.secret;
    }
    if (response.results?.auth.phone) {
        delete response.results.auth.phone.secret;
    }
    if (response.results?.auth.username) {
        delete response.results.auth.username.secret;
    }
    res.fromStatusResponse(response);
}
