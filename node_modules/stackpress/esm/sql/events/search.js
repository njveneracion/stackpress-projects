import search from '../actions/search.js';
export default function searchEventFactory(model) {
    return async function SearchEventAction(req, res, ctx) {
        if (res.body || (res.code && res.code !== 200)) {
            return;
        }
        if (!req.data.has('columns')
            && Array.isArray(model.query)
            && model.query.length
            && model.query.every(column => typeof column === 'string')) {
            req.data.set('columns', model.query);
        }
        const engine = ctx.plugin('database');
        if (!engine)
            return;
        const seed = ctx.config.path('database.seed');
        const response = await search(model, engine, req.data(), seed);
        res.fromStatusResponse(response);
    };
}
;
