import nodemailer from 'nodemailer';
import { server } from '@stackpress/ingest/Server';
const emitter = server();
emitter.on('email-send', async function EmailSend(req, res, ctx) {
    if (res.body || (res.code && res.code !== 200)) {
        return;
    }
    const config = ctx.config('email');
    if (!config)
        return;
    const options = req.data();
    const transporter = nodemailer.createTransport(config);
    const info = await new Promise((resolve, reject) => {
        transporter.sendMail(options, (error, info) => {
            if (error) {
                reject(error);
            }
            else {
                resolve(info);
            }
        });
    });
    res.setResults(info);
});
export default emitter;
