import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useState, useEffect } from 'react';
import { useInput } from './Input.js';
import Input from './Input.js';
export function useFile(config) {
    const { defaultValue, onChange, onUpdate, onUpload } = config;
    const [uploading, setUploading] = useState(false);
    const [url, setURL] = useState(defaultValue);
    useEffect(() => {
        url && url.length > 0 && onUpdate && onUpdate(url);
    }, [url]);
    const handlers = {
        change: (e) => {
            if (onUpload && e.target.files?.length) {
                setUploading(true);
                onUpload(e.target.files[0], url => {
                    setURL(url);
                    setUploading(false);
                });
            }
            onChange && onChange(e);
        },
        reset: () => {
            setUploading(false);
            setURL(undefined);
        }
    };
    useInput({ onChange: handlers.change, onUpdate });
    return { uploading, url, handlers };
}
;
export default function File(props) {
    const { uploading: locale = 'Uploading...', name, value, defaultValue, error, style, className, onChange, onUpdate, onUpload, ...attributes } = props;
    const { uploading, url, handlers } = useFile({
        defaultValue: defaultValue || value,
        onChange,
        onUpdate,
        onUpload
    });
    const classNames = ['frui-field-file'];
    if (className) {
        classNames.push(className);
    }
    return (_jsxs("div", { className: classNames.join(' '), style: style, children: [!url && !uploading && (_jsx(Input, { ...attributes, type: "file", error: error, className: "frui-field-file-control", onChange: handlers.change })), !url && uploading && (_jsx("div", { className: "frui-field-file-file", children: _jsx("span", { className: "frui-field-file-link", children: locale }) })), url && (_jsxs("div", { className: "frui-field-file-file", children: [_jsx("a", { className: "frui-field-file-link", href: url, target: "_blank", rel: "noreferrer", children: url }), _jsx("div", { className: "frui-field-file-reset", onClick: () => handlers.reset(), children: "\u00D7" }), _jsx("input", { type: "hidden", name: name, value: url })] }))] }));
}
